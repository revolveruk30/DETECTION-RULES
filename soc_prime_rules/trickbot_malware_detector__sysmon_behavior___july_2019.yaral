rule trickbot_malware_detector_sysmon_behavior_july_2019 {
 meta:
    author = "Lee Archinal"
    description = "This content detects characteristics of the TrickBot Malware that was found in July 2019  License: https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md."
    reference = "https://tdm.socprime.com/tdm/info/s06qUuUPHuOY"
    version = "0.01"
    created = "2019/08/07"
    product = "windows"
    service = "sysmon"
    mitre = "defenense_evasion, t1112"

  events:
(($selection1.metadata.product_event_type = "13" and $selection1.target.registry.registry_key = "HKLM\\SOFTWARE\\MICROSOFT\\SYSTEMCERTIFICATES\\AUTHROOT\\CERTIFICATES\\DAC9024F54D8F6DF94935FB1732638CA6AD77C13" and $selection1.metadata.description = "Blob") or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*Modules.*`) or re.regex($selection1.target.file.full_path, `.*client_id.*`) or re.regex($selection1.target.file.full_path, `.*group_tag.*`) or re.regex($selection1.target.file.full_path, `.*\\Tasks\\Bot.*`) or re.regex($selection1.target.file.full_path, `.*\\config\\systemprofile\\AppData\\Roaming\\client_id`) or re.regex($selection1.target.file.full_path, `.*\\config\\systemprofile\\AppData\\Roaming\\group_tag`) or re.regex($selection1.target.file.full_path, `.*\\Tasks\\Bot\.job`))))

  condition:
    $selection1
}
