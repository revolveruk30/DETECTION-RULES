rule exploit_framework_user_agent {
 meta:
    author = "Florian Roth"
    description = "Detects suspicious user agent strings used by exploit / pentest framworks like Metasploit in proxy logs  License: https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md."
    reference = "https://tdm.socprime.com/tdm/info/oGWtrHYnDS12"
    version = "0.01"
    created = "2021-03-09"
    category = "proxy"

  events:
(re.regex($selection.src.application, `Internet Explorer .*`) or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.2)" or $selection.src.application = "Mozilla/4.0 (compatible; Metasploit RSPEC)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)" or $selection.src.application = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Trident/4.0; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E}; SLCC1; .N" or $selection.src.application = "Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)" or $selection.src.application = "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/4.0.221.6 Safari/525.13" or $selection.src.application = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MAAU)" or $selection.src.application = "Mozilla/5.0" or $selection.src.application = "Mozilla/4.0 (compatible; SPIPE/1.0" or $selection.src.application = "Mozilla/5.0 (Windows NT 6.3; rv:39.0) Gecko/20100101 Firefox/35.0" or $selection.src.application = "Sametime Community Agent" or $selection.src.application = "X-FORWARDED-FOR" or $selection.src.application = "DotDotPwn v2.1" or $selection.src.application = "SIPDROID" or $selection.src.application = "Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:60.0)" or re.regex($selection.src.application, `.*wordpress hash grabber.*`) or re.regex($selection.src.application, `.*exploit.*`))

  condition:
    $selection
}
