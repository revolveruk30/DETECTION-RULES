rule swisyn_malware_detector_sysmon_behavior_august_2019 {
 meta:
    author = "Lee Archinal"
    description = "This content detects charactaristics of the Syisyn malware strain  License: https://github.com/Neo23x0/sigma/blob/master/LICENSE.Detection.Rules.md."
    reference = "https://tdm.socprime.com/tdm/info/H1PU44tLRSj2"
    version = "0.01"
    created = "2019/08/15"
    product = "windows"
    service = "sysmon"
    mitre = "defense_evasion, t1112"

  events:
((($selection1.metadata.product_event_type = "13" and $selection1.target.registry.registry_key = "HKLM\\SYSTEM\\CONTROLSET001\\SERVICES\\WINMSS" and ($selection1.metadata.description = "Type" or $selection1.metadata.description = "Start" or $selection1.metadata.description = "ErrorControl" or $selection1.metadata.description = "ImagePath" or $selection1.metadata.description = "DisplayName" or $selection1.metadata.description = "WOW64" or $selection1.metadata.description = "ObjectName" or $selection1.metadata.description = "Description")) or ($selection1.metadata.product_event_type = "11" and (re.regex($selection1.target.file.full_path, `.*\\SfcApi`) or $selection1.target.file.full_path = "C:\\inf\\oem13.PNF" or $selection1.target.file.full_path = "C:\\inf\\oem13.inf" or $selection1.target.file.full_path = "C:\\LastGood\\system32\\DRIVERS\\winyyy.sys (copy)" or $selection1.target.file.full_path = "C:\\Temp\\OLD5.tmp" or $selection1.target.file.full_path = "C:\\inf\\INFCACHE.0" or $selection1.target.file.full_path = "C:\\inf\\INFCACHE.1 (copy)" or $selection1.target.file.full_path = "C:\\stin.bat" or $selection1.target.file.full_path = "C:\\Windows\\System32\\DRIVERS\\winyyy.sys (copy)" or $selection1.target.file.full_path = "C:\\Windows\\System32\\drivers\\SET3.tmp" or $selection1.target.file.full_path = "C:\\Windows\\System32\\drivers\\SET6.tmp" or $selection1.target.file.full_path = "C:\\winsys.exe" or $selection1.target.file.full_path = "C:\\winsys.inf" or $selection1.target.file.full_path = "C:\\winyyy.sys" or $selection1.target.file.full_path = "C:\\SMSS.bat" or $selection1.target.file.full_path = "C:\\lsass.exe" or $selection1.target.file.full_path = "C:\\winhost.exe" or $selection1.target.file.full_path = "C:\\SysWOW64\\SMSS.bat" or $selection1.target.file.full_path = "C:\\SysWOW64\\lsasys.exe" or $selection1.target.file.full_path = "C:\\SysWOW64\\winhost.exe" or $selection1.target.file.full_path = "C:\\Windows\\System32\\SMSS.bat" or $selection1.target.file.full_path = "C:\\Windows\\System32\\lsasys.exe" or $selection1.target.file.full_path = "C:\\Windows\\System32\\winhost.exe"))) or ($selection1.metadata.product_event_type = "1" and ($selection1.target.process.file.full_path = "C:\\Windows\\System32\\winhost.exe" or $selection1.target.process.file.full_path = "C:\\Windows\\System32\\lsasys.exe" or $selection1.target.process.file.full_path = "C:\\SysWOW64\\winhost.exe" or $selection1.target.process.file.full_path = "C:\\SysWOW64\\lsasys.exe" or $selection1.target.process.file.full_path = "C:\\lsass.exe" or $selection1.target.process.file.full_path = "C:\\winsys.exe")))

  condition:
    $selection1
}
